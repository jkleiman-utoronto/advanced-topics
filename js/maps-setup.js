/* global L:false document:false $:false */
// that first line stops your editor from complaining about these variables
// being undefined, but it will still get mad at you if you accidentlaly try to change
// their values (which you must not do!!)
// `L` is the global Leaflet API object, which must be defined before this
// script is loaded
// `document` is of course the HTML document
// $ is the jQuery object (actually we're not using it here at the moment)
// but just in case you would like to make use of it, it's available


///////////////////////////////////////////////
// VARS!! VARS!! VARS!! VARS!! VARS!! VARS!! //
///////////////////////////////////////////////

//////////////////////////
// Globally Scoped Vars //
//////////////////////////

// In order to access map data, we need some of these variables to
// be defined in global scope. In some cases we can assign values here;
// in others we'll wait till we run the initialization function
// we do this here to make sure we can access them
// whenever we need to -- they have 'global scope'

// map initialization variables
let projectMap, // this will hold the map once it's initialized
    myCenter = [ 39.9028, 12.496 ], // [ 55.4907, -1.594], // *latitude*, then longitude the center is Rome
    myZoom = 4; // set your preferred zoom here. higher number is closer in.
                // I set the zoom wide to give access to context before zooming in


// I'm complicating things a bit with this next set of variables, which will help us
// to make multi-colored markers.
// color options are red, blue, green, orange, yellow, violet, grey, black
// to use one of the ones I haven't provided here, 
// just substitute the color name in the URL value (just before `.png`)
const greenURL = 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      yellowURL = 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
      greyURL = 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png';

// create new icon classes
// I've added this just in case you want very fine control over your marker placement
const myIconClass = L.Icon.extend({
    options: {
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    }});
// create the new icon types -- cf. https://leafletjs.com/examples/custom-icons/ and
// also https://leafletjs.com/reference-1.5.0.html#icon
const gryfIcon = new myIconClass({iconUrl: yellowURL}),
      slythIcon = new myIconClass({iconUrl: greenURL}),
      mysteryIcon = new myIconClass({iconUrl: greyURL});


// storing colors in variables, to make it easier to change all the related features at once
// you should probably do this too. 
let gryfCol = 'yellow',
    slythCol = 'green',
    hogCol = 'grey',
    meadeCol = 'rgb(40,40,120)',
    riverCol = 'rgb(0,0,128)';
    japanCol = 'red'
    romeCol = 'purple'
    wallCol = 'black'

///////////////////////////////////////////////////////////////////////
// CHANGE THESE VARIABLE NAMES AND THEIR VALUES TO SUIT YOUR PROJECT //
// It's easy to do this in VSCode: right-click on a variable name    //
// and choose "rename symbol"                                        //
///////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////
// DATA DATA DATA DATA                                  //
// DATA DATA DATA DATA                                  //
//////////////////////////////////////////////////////////


//////////////////////////////////
// MAP DATA PART 1: MARKER INFO //
//////////////////////////////////

///////////////////////////////
// YOU NEED TO CHANGE THESE! //
///////////////////////////////

// These are placeholder arrays; we use them to generate other JS variables
// that will be more useful to us later on
// but writing them this way keeps the code as D.R.Y. as possible
let barMarkerInfo =
    [
        {position: [55.48997247517858,-1.5944015979766843],
         title: "Room of Requirement",
         description: '<p>one half of the Cabinet is located here.</p>'
        },
        {position: [55.49058639152367,-1.5940092937469482],
         title: "Fenrir Greyback",
         description: `<p>An evil and spiteful werewolf, he thirsts for blood and impatiently awaits Dumbledore's demise.</p>`
        },
        {position: [55.61679475360749,-1.6392910480499268],
         title: "Isle of the Locket",
         description: `<p>A forlorn and terrifying sea cave, guarded by an army of the undead and many other magical protections</p>`},
        {position: [ 55.49086601004396, -1.5939261297996548 ],
         title: "Draco Malfoy",
         description: "<p>Weak-willed, dissatisfied, and a natural bully, Draco Malfoy has nonetheless plotted the murder of his own headmaster.</p>"},
        {position: [ 55.49046495468512, -1.5939583064545149 ],
         title: "Severus Snape",
         icon: mysteryIcon,
         description: `<p>what drives him? How has he survived so long with so much decption, such intense longing, guilt, and hatred?`}
    ],
    romeMarkerInfo =
    [{position: [41.9028,12.49046],
      title: "Rome",
      description: "<p>The Eternal City, Rome was the capital of the Roman Empire until strategic considerations moved it to Ravenna and later Constantinople. The city was founded in 753 B.C and at the height of the Roman Empire all power emanated from it.</p>"
      
     },
     {position: [50.9375,6.9603],
      title: "Colonia Claudia Ara Agrippinensium",
      description: "<p>The Eternal City, Rome was the capital of the Roman Empire until strategic considerations moved it to Ravenna and later Constantinople. The city was founded in 753 B.C and at the height of the Roman Empire all power emanated from it.</p>"
      
     }
    
    
    ];



let gryfMarkers = processMarkerLayer(romeMarkerInfo,
                                     {description: 'Roman Places', defaultIcon: gryfIcon}),
    barMarkers = processMarkerLayer(barMarkerInfo,
                                      {description: 'Barbarian Places and Events', defaultIcon: slythIcon});



//////////////////////////////
// MAP DATA PART 2: GEOJSON //
//////////////////////////////

// With this powerful feature you can add arbitrary
// data layers to your map.  It's cool. Learn more at:
// https://leafletjs.com/examples/geojson/
// but essentially: we can add all kinds of features here, including polygons and other shapes
// you can create geoJSON layers here: http://geojson.io/
// and learn more about the format here: https://en.wikipedia.org/wiki/GeoJSON
// to set the line and fill color, you will need to set the `myColor` property as below. 
const townsData={
    "type": "FeatureCollection",
    "description": "Roman Areas of Control",
  "features": [
   
    {
      "type": "Feature",
      "properties": {myColor: romeCol, title: "Roman Britain", description: "Civilized land in the south and a wild frigid north, seperated by a massive wall. Sound familiar?"},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -3.00201416015625,
              54.94134346682221
            ],
            [
              -3.1256103515625,
              54.92556359916315
            ],
            [
              -3.2135009765625,
              54.950808415794604
            ],
            [
              -3.27667236328125,
              54.944498697428536
            ],
            [
              -3.30413818359375,
              54.917671343429596
            ],
            [
              -3.28765869140625,
              54.87976696307156
            ],
            [
              -3.3563232421875,
              54.892405720815276
            ],
            [
              -3.40576171875,
              54.85922052458086
            ],
            [
              -3.56781005859375,
              54.656357480617466
            ],
            [
              -3.6474609374999996,
              54.51789312005292
            ],
            [
              -3.5018920898437496,
              54.404544450124035
            ],
            [
              -3.4304809570312496,
              54.295690662032165
            ],
            [
              -3.34259033203125,
              54.189762544552885
            ],
            [
              -3.28216552734375,
              54.15278427641255
            ],
            [
              -3.284912109375,
              54.120602386175754
            ],
            [
              -3.18878173828125,
              54.03842534637411
            ],
            [
              -3.1695556640624996,
              54.08356229415844
            ],
            [
              -2.85369873046875,
              54.172081409976904
            ],
            [
              -2.823486328125,
              54.10450206317112
            ],
            [
              -2.92510986328125,
              54.02713344412541
            ],
            [
              -2.845458984375,
              53.964165263099105
            ],
            [
              -3.0487060546875,
              53.918898590859456
            ],
            [
              -3.06243896484375,
              53.74546241074025
            ],
            [
              -2.933349609375,
              53.71946627930628
            ],
            [
              -3.07342529296875,
              53.629981921409794
            ],
            [
              -3.09539794921875,
              53.54520363618777
            ],
            [
              -3.0487060546875,
              53.44226352500856
            ],
            [
              -3.2135009765625,
              53.38496655811501
            ],
            [
              -3.1091308593749996,
              53.31118556593906
            ],
            [
              -3.10638427734375,
              53.23234504341257
            ],
            [
              -3.3233642578125,
              53.35546948344972
            ],
            [
              -3.74359130859375,
              53.3193897601862
            ],
            [
              -3.878173828125,
              53.33579341819874
            ],
            [
              -3.9880371093749996,
              53.253712042468464
            ],
            [
              -4.15283203125,
              53.225768435790194
            ],
            [
              -4.04571533203125,
              53.31118556593906
            ],
            [
              -4.229736328124999,
              53.33579341819874
            ],
            [
              -4.27093505859375,
              53.41280615440961
            ],
            [
              -4.427490234375,
              53.42917388041458
            ],
            [
              -4.58404541015625,
              53.40134499699225
            ],
            [
              -4.592285156249999,
              53.29969704459091
            ],
            [
              -4.7021484375,
              53.32923271182326
            ],
            [
              -4.691162109375,
              53.291489065300226
            ],
            [
              -4.5648193359375,
              53.24056438248143
            ],
            [
              -4.40277099609375,
              53.1385329912865
            ],
            [
              -4.350585937499999,
              53.11710851455023
            ],
            [
              -4.43023681640625,
              52.996603366272716
            ],
            [
              -4.5977783203125,
              52.93208571886021
            ],
            [
              -4.73236083984375,
              52.85420569896367
            ],
            [
              -4.76531982421875,
              52.796119005678506
            ],
            [
              -4.7406005859375,
              52.784492347358785
            ],
            [
              -4.603271484375,
              52.8210228115302
            ],
            [
              -4.5428466796875,
              52.77618568896171
            ],
            [
              -4.493408203125,
              52.7994403373623
            ],
            [
              -4.35333251953125,
              52.89730555702354
            ],
            [
              -4.15008544921875,
              52.8873632373409
            ],
            [
              -4.1473388671875,
              52.81106300100147
            ],
            [
              -4.07318115234375,
              52.731302332527385
            ],
            [
              -4.130859375,
              52.60971939156648
            ],
            [
              -4.06768798828125,
              52.52958999943304
            ],
            [
              -4.08966064453125,
              52.40074312027673
            ],
            [
              -4.30389404296875,
              52.21602143271678
            ],
            [
              -4.35882568359375,
              52.221069523572794
            ],
            [
              -4.63348388671875,
              52.13854550670474
            ],
            [
              -4.735107421875,
              52.11493908614797
            ],
            [
              -4.89166259765625,
              52.02883848153626
            ],
            [
              -5.0592041015625,
              52.02883848153626
            ],
            [
              -5.1361083984375,
              51.96119237712624
            ],
            [
              -5.3009033203125,
              51.90361280788357
            ],
            [
              -5.30364990234375,
              51.861227743704696
            ],
            [
              -5.13336181640625,
              51.85613885029435
            ],
            [
              -5.0921630859375,
              51.781435604431195
            ],
            [
              -5.16632080078125,
              51.77293876123393
            ],
            [
              -5.24322509765625,
              51.73383267274113
            ],
            [
              -5.185546875,
              51.6810708788698
            ],
            [
              -5.11138916015625,
              51.674258422595145
            ],
            [
              -5.05645751953125,
              51.619721873137614
            ],
            [
              -4.94110107421875,
              51.59413527860747
            ],
            [
              -4.86968994140625,
              51.635066908847826
            ],
            [
              -4.77630615234375,
              51.63677159243599
            ],
            [
              -4.70489501953125,
              51.677664778834455
            ],
            [
              -4.6966552734375,
              51.71171425120453
            ],
            [
              -4.4384765625,
              51.73723454645786
            ],
            [
              -4.383544921875,
              51.723625515056554
            ],
            [
              -4.290161132812499,
              51.66574141105715
            ],
            [
              -4.24346923828125,
              51.645294049305406
            ],
            [
              -4.31488037109375,
              51.60778325682619
            ],
            [
              -4.2572021484375,
              51.53950234032649
            ],
            [
              -4.1583251953125,
              51.5429188223739
            ],
            [
              -3.9797973632812496,
              51.558289817660665
            ],
            [
              -3.9880371093749996,
              51.60607748386585
            ],
            [
              -3.84796142578125,
              51.614605707797466
            ],
            [
              -3.7161254882812496,
              51.472829664858644
            ],
            [
              -3.6557006835937496,
              51.474540439419755
            ],
            [
              -3.5513305664062496,
              51.39920565355378
            ],
            [
              -3.3837890625,
              51.38378095727871
            ],
            [
              -3.1805419921874996,
              51.39749205520681
            ],
            [
              -3.1503295898437496,
              51.469407923261336
            ],
            [
              -3.0047607421875,
              51.53779400311784
            ],
            [
              -2.90313720703125,
              51.536085601784755
            ],
            [
              -2.7191162109375,
              51.582189932691456
            ],
            [
              -2.6641845703125,
              51.57365561973001
            ],
            [
              -2.7877807617187496,
              51.48822432632349
            ],
            [
              -2.8591918945312496,
              51.445448545784195
            ],
            [
              -2.9718017578125,
              51.390637019843744
            ],
            [
              -3.01849365234375,
              51.32889547080779
            ],
            [
              -3.01849365234375,
              51.263633525637
            ],
            [
              -3.02398681640625,
              51.218927150951494
            ],
            [
              -3.1146240234375,
              51.213765926935025
            ],
            [
              -3.19427490234375,
              51.20860412431918
            ],
            [
              -3.2574462890625,
              51.184508061068165
            ],
            [
              -3.416748046875,
              51.18278643144626
            ],
            [
              -3.4606933593749996,
              51.213765926935025
            ],
            [
              -3.570556640625,
              51.232687586462205
            ],
            [
              -3.60626220703125,
              51.21548639922819
            ],
            [
              -3.779296875,
              51.244724592848236
            ],
            [
              -3.9166259765625,
              51.22924786327828
            ],
            [
              -4.08966064453125,
              51.218927150951494
            ],
            [
              -4.199523925781249,
              51.18967256411778
            ],
            [
              -4.2572021484375,
              51.14317120049778
            ],
            [
              -4.24346923828125,
              51.127660326365735
            ],
            [
              -4.21600341796875,
              51.084547222263666
            ],
            [
              -4.24346923828125,
              51.04657442107223
            ],
            [
              -4.3670654296875,
              50.99301440979523
            ],
            [
              -4.4549560546875,
              51.01893827029196
            ],
            [
              -4.531860351562499,
              51.015482592607846
            ],
            [
              -4.559326171875,
              50.89783627109672
            ],
            [
              -4.559326171875,
              50.78336517951859
            ],
            [
              -4.75433349609375,
              50.65990836093937
            ],
            [
              -5.023498535156249,
              50.550089710534856
            ],
            [
              -5.1361083984375,
              50.40851753069726
            ],
            [
              -5.2294921875,
              50.31916186634034
            ],
            [
              -5.3887939453125,
              50.240178884797025
            ],
            [
              -5.4327392578125,
              50.17689812200107
            ],
            [
              -5.4876708984375,
              50.21557967003726
            ],
            [
              -5.55633544921875,
              50.208548992291014
            ],
            [
              -5.696411132812499,
              50.154026111358014
            ],
            [
              -5.71563720703125,
              50.06948077670394
            ],
            [
              -5.69091796875,
              50.03950183762877
            ],
            [
              -5.5810546875,
              50.05008477838258
            ],
            [
              -5.5426025390625,
              50.07300647938297
            ],
            [
              -5.53436279296875,
              50.11705589409776
            ],
            [
              -5.482177734375,
              50.12938247393472
            ],
            [
              -5.43548583984375,
              50.10296448723353
            ],
            [
              -5.3009033203125,
              50.055375373800004
            ],
            [
              -5.23773193359375,
              49.97242235423708
            ],
            [
              -5.11138916015625,
              49.991849726784736
            ],
            [
              -5.064697265625,
              50.027152124306234
            ],
            [
              -5.08941650390625,
              50.10472613984792
            ],
            [
              -5.00152587890625,
              50.14170587960567
            ],
            [
              -4.98779296875,
              50.14522626967904
            ],
            [
              -4.9658203125,
              50.19272617963508
            ],
            [
              -4.91363525390625,
              50.20327530414826
            ],
            [
              -4.85321044921875,
              50.23842221881728
            ],
            [
              -4.79827880859375,
              50.21909462044748
            ],
            [
              -4.773559570312499,
              50.27354323996707
            ],
            [
              -4.779052734375,
              50.32968303000023
            ],
            [
              -4.71038818359375,
              50.35071837038416
            ],
            [
              -4.66094970703125,
              50.32617623423627
            ],
            [
              -4.49066162109375,
              50.331436330838834
            ],
            [
              -4.45220947265625,
              50.35422335480388
            ],
            [
              -4.3121337890625,
              50.36298468388075
            ],
            [
              -4.20501708984375,
              50.31916186634034
            ],
            [
              -4.10888671875,
              50.322669179684944
            ],
            [
              -4.0704345703125,
              50.30162141750973
            ],
            [
              -3.9880371093749996,
              50.305130024910035
            ],
            [
              -3.89190673828125,
              50.28056433749239
            ],
            [
              -3.83148193359375,
              50.21557967003726
            ],
            [
              -3.71337890625,
              50.20327530414826
            ],
            [
              -3.6557006835937496,
              50.22085199853943
            ],
            [
              -3.6419677734374996,
              50.30863837348728
            ],
            [
              -3.5760498046875,
              50.331436330838834
            ],
            [
              -3.5540771484375,
              50.33494273843299
            ],
            [
              -3.51287841796875,
              50.34721312721887
            ],
            [
              -3.46893310546875,
              50.396262987870436
            ],
            [
              -3.5595703125,
              50.42251884281916
            ],
            [
              -3.53759765625,
              50.45750402042058
            ],
            [
              -3.47442626953125,
              50.45750402042058
            ],
            [
              -3.52386474609375,
              50.48722109174841
            ],
            [
              -3.49365234375,
              50.544853857152326
            ],
            [
              -3.4414672851562496,
              50.60764573009061
            ],
            [
              -3.4716796874999996,
              50.67905676828541
            ],
            [
              -3.40850830078125,
              50.61113171332364
            ],
            [
              -3.3206176757812496,
              50.6268154416189
            ],
            [
              -3.2684326171875,
              50.67209461471226
            ],
            [
              -3.1036376953125,
              50.68775800806201
            ],
            [
              -3.02398681640625,
              50.698197366045534
            ],
            [
              -2.900390625,
              50.73471682490245
            ],
            [
              -2.76031494140625,
              50.708634400828224
            ],
            [
              -2.54058837890625,
              50.61461743826628
            ],
            [
              -2.4554443359375,
              50.516919485758045
            ],
            [
              -2.4224853515625,
              50.550089710534856
            ],
            [
              -2.3895263671875,
              50.63901028125873
            ],
            [
              -2.28240966796875,
              50.62158811330538
            ],
            [
              -2.054443359375,
              50.57626025689928
            ],
            [
              -1.9610595703125,
              50.59021193935192
            ],
            [
              -1.94732666015625,
              50.63901028125873
            ],
            [
              -1.94732666015625,
              50.68427770577119
            ],
            [
              -1.74957275390625,
              50.71385204707258
            ],
            [
              -1.56829833984375,
              50.71385204707258
            ],
            [
              -1.59576416015625,
              50.665131428416146
            ],
            [
              -1.505126953125,
              50.66339047047327
            ],
            [
              -1.31561279296875,
              50.57626025689928
            ],
            [
              -1.1810302734375,
              50.588468205090265
            ],
            [
              -1.1700439453125,
              50.649460483096135
            ],
            [
              -1.07940673828125,
              50.677316326707135
            ],
            [
              -1.0876464843749998,
              50.712112896185104
            ],
            [
              -1.2579345703125,
              50.757309850294085
            ],
            [
              -1.2689208984375,
              50.828493376227115
            ],
            [
              -1.20574951171875,
              50.78857450392836
            ],
            [
              -1.08489990234375,
              50.7798919741081
            ],
            [
              -0.9475708007812501,
              50.776418510713604
            ],
            [
              -0.889892578125,
              50.83716687845952
            ],
            [
              -0.90362548828125,
              50.774681682270334
            ],
            [
              -0.791015625,
              50.72428559737425
            ],
            [
              -0.74432373046875,
              50.767733723505344
            ],
            [
              -0.55755615234375,
              50.80246319809847
            ],
            [
              -0.31036376953125,
              50.8232885012118
            ],
            [
              -0.1593017578125,
              50.82155341392253
            ],
            [
              0.098876953125,
              50.76599657256212
            ],
            [
              0.24444580078125003,
              50.736455137010665
            ],
            [
              0.31036376953125,
              50.77294478932867
            ],
            [
              0.33233642578125,
              50.818083045912985
            ],
            [
              0.50262451171875,
              50.84757295365389
            ],
            [
              0.63720703125,
              50.85797670812071
            ],
            [
              0.7223510742187499,
              50.90996067566236
            ],
            [
              0.76629638671875,
              50.92727577667011
            ],
            [
              0.81573486328125,
              50.932469050603345
            ],
            [
              0.9860229492187499,
              50.913424211321335
            ],
            [
              0.95855712890625,
              50.963616518684205
            ],
            [
              0.9722900390624999,
              51.012026657382386
            ],
            [
              1.0601806640625,
              51.06556471552332
            ],
            [
              1.1920166015625,
              51.086272518565515
            ],
            [
              1.27716064453125,
              51.10179728957702
            ],
            [
              1.35955810546875,
              51.13110763758015
            ],
            [
              1.417236328125,
              51.19483648846097
            ],
            [
              1.3568115234375,
              51.334043778789415
            ],
            [
              1.42822265625,
              51.33061163769853
            ],
            [
              1.461181640625,
              51.385495069223204
            ],
            [
              1.3787841796874998,
              51.38892310050487
            ],
            [
              1.0711669921875,
              51.36835106051133
            ],
            [
              0.97503662109375,
              51.339191508712105
            ],
            [
              0.9503173828125,
              51.37863823622004
            ],
            [
              0.9420776367187499,
              51.39577839266317
            ],
            [
              0.8624267578125,
              51.4163381064004
            ],
            [
              0.714111328125,
              51.467696956223385
            ],
            [
              0.61248779296875,
              51.47111882613946
            ],
            [
              0.61798095703125,
              51.51216124955517
            ],
            [
              0.76629638671875,
              51.52241608253253
            ],
            [
              0.9613037109374999,
              51.60437164681676
            ],
            [
              0.9393310546875,
              51.64188525876834
            ],
            [
              0.94482421875,
              51.71681946274873
            ],
            [
              0.9393310546875,
              51.77463825786986
            ],
            [
              1.0052490234375,
              51.80521825434942
            ],
            [
              1.03546142578125,
              51.77123920059797
            ],
            [
              1.09588623046875,
              51.767839887322154
            ],
            [
              1.26068115234375,
              51.83408032720807
            ],
            [
              1.3018798828125,
              51.864620019548866
            ],
            [
              1.2030029296875,
              51.88327296443745
            ],
            [
              1.26068115234375,
              51.92733099026087
            ],
            [
              1.2744140625,
              51.952729426852905
            ],
            [
              1.3238525390624998,
              51.93410531270822
            ],
            [
              1.36505126953125,
              51.96965372996562
            ],
            [
              1.4144897460937498,
              51.99502820505106
            ],
            [
              1.505126953125,
              52.067688721304165
            ],
            [
              1.571044921875,
              52.101444087734635
            ],
            [
              1.7303466796874998,
              52.40577019043
            ],
            [
              1.7578125,
              52.47441608702583
            ],
            [
              1.74957275390625,
              52.501175722709434
            ],
            [
              1.72760009765625,
              52.54796591773237
            ],
            [
              1.7523193359375,
              52.6063835896964
            ],
            [
              1.68365478515625,
              52.736291655910925
            ],
            [
              1.4776611328125,
              52.859180945520826
            ],
            [
              1.28814697265625,
              52.94036259335616
            ],
            [
              1.0711669921875,
              52.9635294209657
            ],
            [
              0.8679199218749999,
              52.9751081817353
            ],
            [
              0.6893920898437499,
              52.9751081817353
            ],
            [
              0.54931640625,
              52.976762037220865
            ],
            [
              0.4998779296875,
              52.96022063388111
            ],
            [
              0.45867919921875006,
              52.89564866211353
            ],
            [
              0.38726806640625,
              52.8210228115302
            ],
            [
              0.31585693359374994,
              52.81106300100147
            ],
            [
              0.22247314453125,
              52.819363001597885
            ],
            [
              0.17303466796874997,
              52.86415562175207
            ],
            [
              0.142822265625,
              52.8823912222619
            ],
            [
              0.05218505859375,
              52.92546307943839
            ],
            [
              0.087890625,
              52.96022063388111
            ],
            [
              0.20050048828125,
              53.03625868781451
            ],
            [
              0.2801513671875,
              53.07422751310222
            ],
            [
              0.3350830078125,
              53.09402405506325
            ],
            [
              0.3570556640625,
              53.207677555890015
            ],
            [
              0.16754150390625,
              53.48477702972815
            ],
            [
              -0.030212402343749997,
              53.5680452905466
            ],
            [
              -0.0823974609375,
              53.56967636543384
            ],
            [
              -0.27740478515625,
              53.699958629657445
            ],
            [
              -0.22521972656249997,
              53.712964734406825
            ],
            [
              -0.07965087890625,
              53.62672436247066
            ],
            [
              0.03570556640625,
              53.64952199454264
            ],
            [
              0.15106201171874997,
              53.608803292930865
            ],
            [
              0.0714111328125,
              53.70483639004964
            ],
            [
              -0.08514404296875,
              53.81038242731128
            ],
            [
              -0.2032470703125,
              53.98032002986215
            ],
            [
              -0.2197265625,
              54.05293900056246
            ],
            [
              -0.186767578125,
              54.0900064257852
            ],
            [
              -0.12908935546875,
              54.09967074689618
            ],
            [
              -0.0714111328125,
              54.11577294581963
            ],
            [
              -0.1263427734375,
              54.13508733112155
            ],
            [
              -0.2801513671875,
              54.1801192265262
            ],
            [
              -0.263671875,
              54.210648685175904
            ],
            [
              -0.39001464843749994,
              54.26361995010228
            ],
            [
              -0.42022705078124994,
              54.31812530957771
            ],
            [
              -0.47515869140625,
              54.394951300276965
            ],
            [
              -0.53558349609375,
              54.41892996865827
            ],
            [
              -0.51361083984375,
              54.439700141577894
            ],
            [
              -0.57952880859375,
              54.478017421505875
            ],
            [
              -0.84869384765625,
              54.56410020448973
            ],
            [
              -1.16729736328125,
              54.64205540129178
            ],
            [
              -1.1865234375,
              54.69764633407973
            ],
            [
              -1.29913330078125,
              54.75474622186897
            ],
            [
              -1.31561279296875,
              54.81018290195898
            ],
            [
              -1.3540649414062498,
              54.88608683754535
            ],
            [
              -1.36505126953125,
              54.944498697428536
            ],
            [
              -1.34857177734375,
              54.963424881416756
            ],
            [
              -1.41998291015625,
              55.00125051509462
            ],
            [
              -1.49688720703125,
              54.982342153260305
            ],
            [
              -1.527099609375,
              54.97288463122321
            ],
            [
              -1.60675048828125,
              54.963424881416756
            ],
            [
              -1.69464111328125,
              54.97288463122321
            ],
            [
              -1.79901123046875,
              55.00282580979323
            ],
            [
              -1.9143676757812498,
              54.98076605428234
            ],
            [
              -1.9418334960937498,
              54.95869417101661
            ],
            [
              -1.99676513671875,
              54.97918989342808
            ],
            [
              -2.0654296875,
              54.97761367069625
            ],
            [
              -2.20001220703125,
              54.9902217200489
            ],
            [
              -2.24395751953125,
              54.96973162883084
            ],
            [
              -2.32086181640625,
              54.97761367069625
            ],
            [
              -2.43072509765625,
              54.968155034807836
            ],
            [
              -2.581787109375,
              54.97446103959508
            ],
            [
              -2.73284912109375,
              54.9381879885872
            ],
            [
              -3.00201416015625,
              54.94134346682221
            ]
          ]
        ]
      }
    },


        {
          "type": "Feature",
          "properties": {myColor: romeCol, title: "Roman Empire except for Britain c. 117 AD", description: "At its height the empire stretched from Lisbon to Kuwait"},
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -8.942871093749998,
                  37.07271048132943
                ],
                [
                  -7.778320312499999,
                  37.125286284966776
                ],
                [
                  -6.767578125,
                  36.98500309285596
                ],
                [
                  -6.416015625,
                  36.56260003738545
                ],
                [
                  -5.756835937499999,
                  35.85343961959182
                ],
                [
                  -6.416015625,
                  34.488447837809304
                ],
                [
                  -7.9541015625,
                  33.35806161277885
                ],
                [
                  -9.228515625,
                  32.65787573695528
                ],
                [
                  -9.7998046875,
                  31.391157522824695
                ],
                [
                  -9.5361328125,
                  30.637912028341123
                ],
                [
                  -9.0087890625,
                  30.713503990354965
                ],
                [
                  -3.8232421874999996,
                  31.989441837922904
                ],
                [
                  -1.5380859375,
                  31.989441837922904
                ],
                [
                  1.6259765625,
                  33.65120829920497
                ],
                [
                  3.4716796874999996,
                  34.415973384481866
                ],
                [
                  6.328125,
                  34.23451236236987
                ],
                [
                  7.998046875,
                  34.016241889667015
                ],
                [
                  9.184570312499998,
                  33.7243396617476
                ],
                [
                  9.84375,
                  33.02708758002874
                ],
                [
                  10.458984375,
                  32.02670629333614
                ],
                [
                  11.2939453125,
                  31.541089879585808
                ],
                [
                  15.3369140625,
                  30.524413269923986
                ],
                [
                  16.6552734375,
                  29.954934549656144
                ],
                [
                  19.0283203125,
                  29.726222319395504
                ],
                [
                  19.9951171875,
                  29.6880527498568
                ],
                [
                  20.7421875,
                  30.524413269923986
                ],
                [
                  21.884765625,
                  31.090574094954167
                ],
                [
                  23.2470703125,
                  29.916852233070173
                ],
                [
                  24.3896484375,
                  28.65203063036226
                ],
                [
                  25.048828125,
                  27.332735136859146
                ],
                [
                  25.6640625,
                  25.839449402063185
                ],
                [
                  26.19140625,
                  25.005972656239187
                ],
                [
                  28.037109375,
                  24.56710835257599
                ],
                [
                  29.3994140625,
                  24.56710835257599
                ],
                [
                  31.5087890625,
                  24.44714958973082
                ],
                [
                  33.0029296875,
                  24.487148563173424
                ],
                [
                  35.1123046875,
                  24.686952411999155
                ],
                [
                  34.661865234375,
                  25.473033261279515
                ],
                [
                  33.59619140624999,
                  27.410785702577023
                ],
                [
                  34.134521484375,
                  27.780771643348196
                ],
                [
                  34.62890625,
                  28.07198030177986
                ],
                [
                  34.903564453125,
                  28.120438687101064
                ],
                [
                  35.04638671874999,
                  29.35345166863502
                ],
                [
                  35.52978515624999,
                  29.859701442126756
                ],
                [
                  37.58422851562499,
                  30.486550842588485
                ],
                [
                  39.04541015625,
                  31.38177878211098
                ],
                [
                  41.3525390625,
                  31.419288124288357
                ],
                [
                  44.736328125,
                  29.21930207677943
                ],
                [
                  46.527099609375,
                  29.123373210819224
                ],
                [
                  48.35083007812499,
                  28.57487404744697
                ],
                [
                  47.955322265625,
                  29.935895213372444
                ],
                [
                  47.493896484375,
                  31.22219703210317
                ],
                [
                  46.3623046875,
                  32.33355894864109
                ],
                [
                  45.362548828125,
                  32.96258644191747
                ],
                [
                  44.18701171875,
                  35.25459097465022
                ],
                [
                  43.9892578125,
                  36.13787471840729
                ],
                [
                  43.96728515625,
                  38.16047628099622
                ],
                [
                  44.24194335937499,
                  39.631076770083666
                ],
                [
                  45.252685546875,
                  39.757879992021756
                ],
                [
                  45.81298828124999,
                  40.027614437486655
                ],
                [
                  46.90063476562499,
                  40.54720023441049
                ],
                [
                  46.768798828125,
                  41.03793062246529
                ],
                [
                  46.285400390625,
                  41.5579215778042
                ],
                [
                  45.3955078125,
                  41.84501267270689
                ],
                [
                  44.307861328125,
                  42.19596877629178
                ],
                [
                  42.835693359375,
                  42.30169032824452
                ],
                [
                  41.737060546875,
                  42.39912215986002
                ],
                [
                  41.802978515625,
                  41.934976500546604
                ],
                [
                  41.627197265625,
                  41.6154423246811
                ],
                [
                  40.989990234375,
                  41.253032440653186
                ],
                [
                  40.462646484375,
                  41.04621681452063
                ],
                [
                  39.990234375,
                  40.90520969727358
                ],
                [
                  39.5068359375,
                  41.11246878918086
                ],
                [
                  39.0673828125,
                  41.054501963290505
                ],
                [
                  38.902587890625,
                  41.021355108666
                ],
                [
                  38.243408203125,
                  40.93841495689793
                ],
                [
                  37.68310546875,
                  41.09591205639546
                ],
                [
                  37.55126953125,
                  41.0130657870063
                ],
                [
                  37.1337890625,
                  41.178653972331674
                ],
                [
                  36.925048828125,
                  41.29431726315258
                ],
                [
                  36.650390625,
                  41.352072144512924
                ],
                [
                  36.353759765625,
                  41.269549502842565
                ],
                [
                  36.177978515625,
                  41.52502957323801
                ],
                [
                  35.914306640625,
                  41.705728515237524
                ],
                [
                  35.7275390625,
                  41.590796851056005
                ],
                [
                  35.123291015625,
                  41.82045509614034
                ],
                [
                  35.123291015625,
                  42.04113400940807
                ],
                [
                  35.0244140625,
                  42.09007006868398
                ],
                [
                  34.65087890625,
                  41.95131994679697
                ],
                [
                  33.35449218749999,
                  42.01665183556825
                ],
                [
                  32.6513671875,
                  41.86956082699455
                ],
                [
                  31.497802734375,
                  41.352072144512924
                ],
                [
                  31.289062500000004,
                  41.08763212467916
                ],
                [
                  29.77294921875,
                  41.17038447781618
                ],
                [
                  29.256591796874996,
                  41.21998578493921
                ],
                [
                  28.070068359375,
                  41.599013054830216
                ],
                [
                  28.0810546875,
                  41.95949009892467
                ],
                [
                  27.630615234375,
                  42.439674178149424
                ],
                [
                  27.301025390625,
                  42.391008609205045
                ],
                [
                  27.894287109374996,
                  42.72280375732727
                ],
                [
                  27.9052734375,
                  43.18915769654922
                ],
                [
                  28.092041015625,
                  43.39706523932025
                ],
                [
                  28.564453125,
                  43.46886761482923
                ],
                [
                  28.58642578125,
                  43.76315996157264
                ],
                [
                  28.795166015625,
                  44.59829048984011
                ],
                [
                  28.927001953125,
                  44.98034238084973
                ],
                [
                  29.619140624999996,
                  44.879228141635245
                ],
                [
                  29.7509765625,
                  45.62940492064501
                ],
                [
                  30.146484374999996,
                  45.82114340079471
                ],
                [
                  30.563964843750004,
                  46.17222297845542
                ],
                [
                  30.805664062500004,
                  46.543749602738565
                ],
                [
                  31.827392578125,
                  46.626806395355175
                ],
                [
                  31.937255859375,
                  46.800059446787316
                ],
                [
                  31.761474609375,
                  47.00273390667881
                ],
                [
                  30.95947265625,
                  46.97275640318636
                ],
                [
                  30.41015625,
                  46.807579571992385
                ],
                [
                  29.718017578125004,
                  46.07323062540835
                ],
                [
                  29.311523437499996,
                  45.4524242413431
                ],
                [
                  28.5205078125,
                  45.26715476332791
                ],
                [
                  28.201904296875,
                  45.66012730272194
                ],
                [
                  27.388916015625,
                  46.195042108660154
                ],
                [
                  26.6748046875,
                  46.92025531537451
                ],
                [
                  25.960693359374996,
                  47.32393057095941
                ],
                [
                  25.279541015625,
                  47.204642388766935
                ],
                [
                  23.7744140625,
                  47.234489635299184
                ],
                [
                  22.96142578125,
                  46.74738913515841
                ],
                [
                  22.412109375,
                  46.42271253466717
                ],
                [
                  22.0166015625,
                  46.05036097561633
                ],
                [
                  21.796875,
                  45.4986468234261
                ],
                [
                  21.588134765625,
                  45.058001435398296
                ],
                [
                  21.37939453125,
                  44.84029065139799
                ],
                [
                  20.63232421875,
                  44.73892994307368
                ],
                [
                  20.489501953125,
                  44.89479576469787
                ],
                [
                  20.006103515625,
                  45.205263456162385
                ],
                [
                  19.094238281249996,
                  45.3444241045224
                ],
                [
                  18.929443359375,
                  45.583289756006316
                ],
                [
                  18.863525390625,
                  45.97406038956237
                ],
                [
                  18.907470703125,
                  46.72480037466717
                ],
                [
                  18.995361328125,
                  47.4057852900587
                ],
                [
                  18.96240234375,
                  47.754097979680026
                ],
                [
                  18.533935546875,
                  47.76886840424207
                ],
                [
                  17.77587890625,
                  47.76886840424207
                ],
                [
                  17.039794921874996,
                  48.144097934938884
                ],
                [
                  16.490478515625,
                  48.16608541901253
                ],
                [
                  15.84228515625,
                  48.4146186174932
                ],
                [
                  14.820556640625,
                  48.22467264956519
                ],
                [
                  13.99658203125,
                  48.356249029540734
                ],
                [
                  11.074218749999998,
                  49.532339195028115
                ],
                [
                  10.557861328125,
                  49.674737880665994
                ],
                [
                  8.734130859375,
                  50.078294547389426
                ],
                [
                  8.32763671875,
                  49.96535590991311
                ],
                [
                  7.646484374999999,
                  50.331436330838834
                ],
                [
                  7.119140625,
                  50.65990836093937
                ],
                [
                  6.844482421875,
                  51.20688339486559
                ],
                [
                  6.1083984375,
                  51.781435604431195
                ],
                [
                  5.614013671875,
                  51.91716758909015
                ],
                [
                  5.25146484375,
                  51.85613885029435
                ],
                [
                  4.04296875,
                  51.896833883012484
                ],
                [
                  3.3837890625,
                  51.56341232867588
                ],
                [
                  3.8671874999999996,
                  51.29627609493991
                ],
                [
                  3.5595703125,
                  51.39235087498254
                ],
                [
                  3.306884765625,
                  51.358061573190916
                ],
                [
                  1.6809082031249998,
                  50.93766174471314
                ],
                [
                  1.60400390625,
                  50.84063582806037
                ],
                [
                  1.5380859375,
                  50.198001033269506
                ],
                [
                  0.8349609375,
                  49.92293545449574
                ],
                [
                  0.164794921875,
                  49.688954878870305
                ],
                [
                  0.12084960937499999,
                  49.43241258024849
                ],
                [
                  -0.10986328125,
                  49.28930640196742
                ],
                [
                  -0.384521484375,
                  49.33228198473771
                ],
                [
                  -0.823974609375,
                  49.37522008143603
                ],
                [
                  -1.2634277343749998,
                  49.44670029695474
                ],
                [
                  -1.219482421875,
                  49.6462914122132
                ],
                [
                  -1.40625,
                  49.710272582105695
                ],
                [
                  -1.966552734375,
                  49.7315809334801
                ],
                [
                  -1.8127441406249998,
                  49.396675075193976
                ],
                [
                  -1.527099609375,
                  48.7996273507997
                ],
                [
                  -1.351318359375,
                  48.64016871811908
                ],
                [
                  -1.77978515625,
                  48.62564740882851
                ],
                [
                  -1.9335937499999998,
                  48.71271258145237
                ],
                [
                  -2.1752929687499996,
                  48.574789910928864
                ],
                [
                  -2.340087890625,
                  48.669198799260045
                ],
                [
                  -2.581787109375,
                  48.545705491847464
                ],
                [
                  -2.823486328125,
                  48.61112192003074
                ],
                [
                  -3.09814453125,
                  48.86471476180277
                ],
                [
                  -3.2958984375,
                  48.828565527993234
                ],
                [
                  -3.5815429687499996,
                  48.73445537176822
                ],
                [
                  -3.9660644531249996,
                  48.705462895790546
                ],
                [
                  -4.537353515625,
                  48.60385760823255
                ],
                [
                  -4.7021484375,
                  48.574789910928864
                ],
                [
                  -4.801025390625,
                  48.37084770238366
                ],
                [
                  -4.32861328125,
                  48.20271028869972
                ],
                [
                  -4.658203125,
                  48.05605376398125
                ],
                [
                  -4.24072265625,
                  47.79101617826261
                ],
                [
                  -4.031982421875,
                  47.89424772020999
                ],
                [
                  -3.218994140625,
                  47.61356975397398
                ],
                [
                  -2.537841796875,
                  47.36115300722623
                ],
                [
                  -2.142333984375,
                  46.837649560937464
                ],
                [
                  -1.417236328125,
                  46.00459325574482
                ],
                [
                  -1.0986328125,
                  45.537136680398596
                ],
                [
                  -1.219482421875,
                  44.574817404670306
                ],
                [
                  -1.724853515625,
                  43.37311218382002
                ],
                [
                  -2.21923828125,
                  43.27720532212024
                ],
                [
                  -2.83447265625,
                  43.44494295526125
                ],
                [
                  -3.1640625,
                  43.36512572875844
                ],
                [
                  -3.570556640625,
                  43.492782808225
                ],
                [
                  -3.856201171875,
                  43.46886761482923
                ],
                [
                  -4.81201171875,
                  43.42898792344157
                ],
                [
                  -5.8447265625,
                  43.65197548731187
                ],
                [
                  -6.954345703125,
                  43.51668853502906
                ],
                [
                  -7.899169921874999,
                  43.739352079154706
                ],
                [
                  -8.228759765625,
                  43.58039085560784
                ],
                [
                  -8.37158203125,
                  43.32517767999296
                ],
                [
                  -9.129638671875,
                  43.1811470593997
                ],
                [
                  -9.283447265625,
                  42.99661231842139
                ],
                [
                  -9.03076171875,
                  42.52879629320373
                ],
                [
                  -8.734130859375,
                  42.52879629320373
                ],
                [
                  -8.89892578125,
                  41.96765920367816
                ],
                [
                  -8.8330078125,
                  40.34654412118006
                ],
                [
                  -9.5361328125,
                  38.90813299596705
                ],
                [
                  -9.29443359375,
                  38.39333888832238
                ],
                [
                  -8.76708984375,
                  38.496593518947584
                ],
                [
                  -8.942871093749998,
                  37.07271048132943
                ]
              ]
            ]
          }
        },
        
    

        
  
        
  ]
}

let towns = processJSONLayer(townsData)

////////////////////////////////////////////////////////
// MAP DATA PART 3: DIRECT CREATION OF SHAPE OVERLAYS //
////////////////////////////////////////////////////////


// Hogwarts Buildings Objects and LayerGroup
// API docs: https://leafletjs.com/reference-1.5.0.html#polygon
//  (keep scrolling for docs on rectangles and circles)
let gryffindor = L.rectangle([[ 55.49021561150901, -1.5941441059112549],
                              [55.49107265510559,-1.5931355953216553]], {
    color: gryfCol,
    opacity: 0.8,
    weight: 2,
    fillColor: gryfCol,
    fillOpacity: 0.35,
    title: 'Gryffindor',
    windowContent: `<h3>Gryffindor</h3><p>The Good Guys Live here</p3>`
});

let slytherin = L.rectangle([[ 55.48954090449621, -1.5956997871398926], [55.490288552115494, -1.594712734222412]], {
    color: 'blue',
    opacity: 0.8,
    weight: 2,
    fillColor: slythCol,
    fillOpacity: 0.35,
    title: 'Slytherin',
    windowContent: `<h3>Slytherin</h3><p>The Bad Guys Live here</p3>`
});

let headmasterTower = L.circle([55.4907, -1.5944], {
    color: riverCol,
    opacity: 0.8,
    weight: 2,
    fillColor: riverCol,
    fillOpacity: 0.35,
    radius: 40,
    title: 'Headmaster\'s Tower',
    windowContent: `<h3>Headmaster's Tower</h3><p>Scene of the the Fatal Act.</p>`
});






// Polyline Objects and Layer Group ("paths")
let hadriansWall = L.polyline([
  [
    54.94607621987403,
    -3.0047607421875
  ],
  [
    54.93976575865891,
    -2.896270751953125
  ],
  [
    54.94055462047904,
    -2.717742919921875
  ],
  [
    54.97603738608567,
    -2.58453369140625

  ],
  [ 
    54.96973162883084,
    -2.404632568359375
  ],
  [
    54.97840178979695,
    -2.3263549804687496
  ],
  [
    54.97130816096889,
    -2.2576904296875
  ],
  [
    54.989433832975095,
    -2.197265625
  ],
  [
    54.982342153260305,
    -2.0050048828124996
  ],
  [
    54.957905665127264,
    -1.9377136230468748
  ],
  [
    54.98076605428234,
    -1.915740966796875
  ],
  [ 55.00282580979323,
    -1.8045043945312502
  ],
  [
    54.961848039841584,
    -1.619110107421875
    
  ],
  [
    54.96500166110205,
    -1.564178466796875
    
  ],
  [
    54.961848039841584,
    -1.531219482421875
    
  ],
  [
    54.981554111505794,
    -1.528472900390625
    
  ],
  [
    54.987070078948776,
    -1.509246826171875
    
  ],
  [
    54.9878580124252,
    -1.4666748046875
    
  ],
  [
    55.000462844547805,
    -1.4241027832031248
  ]
], {
                                    color: wallCol,
                                    weight: 5,
                                    title: 'Hadrian\'s Wall',
                                    windowContent: `<h3>Hadrian's Wall</h3><p>Roughly 70 miles long, the wall shielded Roman Britannia from the Picts in Caledonia. Much of the wall still stands today and it is a testament to Roman engineering. It was constructed in 122 A.D</p><img width = "200" height = "100" style ="display: block; margin-left: auto; margin-right: auto;" src="https://www.history.com/.image/t_share/MTU3ODc4NjA0MDU5MzIyMDc5/istock_41785482_large-2.jpg">`})


let rhineRiver = L.polyline([
  [
    47.585789182379905,
    7.597045898437499
  ],
  [
    47.669086647137576,
    7.522888183593749
  ],
  [
    47.78548011929362,
    7.536621093749999
  ],
  [
    47.99175981578037,
    7.6080322265625
  ],
  [
    48.156925112380684,
    7.583312988281249
  ],
  [
    48.372672242291294,
    7.731628417968751  ],
  [
    48.669198799260045,
    7.811279296874999
  ],
  [
    48.922499263758255,
    8.19580078125
  ],
  [
    49.167338606291075,
    8.378448486328125
  ],
  [
    49.433305684498514,
    8.466339111328123
  ],
  [
    49.692508478893274,
    8.348236083984375
  ],
  [
    49.759090381472014,
    8.485565185546875
  ],
  [
    49.79456339537415,
    8.405914306640623
  ],
  [
    50.02009371923324,
    8.265838623046875
  ],
  [
    49.974188803210936,
    7.908782958984374
  ],
  [
    50.31390041107301,
    7.5750732421875
  ],
  [
    50.37875100137005,
    7.60528564453125
  ],
  [
    50.46100111599232,
    7.356719970703125
  ],
  [
    50.71646065241738,
    7.14385986328125  ],
  [
    50.8241560206779,
    6.994171142578125
  ],
  [
    51.04312080348012,
    6.954345703125
  ],
  [
    51.21118509795345,
    6.716766357421874
  ],
  [
    51.653814904471545,
    6.595916748046874
  ],
  [
    51.832383069996645,
    6.216888427734375
  ],
  [
    51.90530737927636,
    5.567321777343749
  ],
  [
    51.87140380383993,
    5.414886474609375
  ],
  [
    51.80861475198521,
    5.361328125
  ],
  [
    51.818802709382474,
    4.89990234375
  ],
  [
    51.749989292270044,
    4.72137451171875
  ],
  [
    51.6180165487737,
    4.19677734375
  ]
],{
                                    color: riverCol,
                                    weight: 5,
                                    title: 'The River Rhine',
                                    windowContent: `<h3>The Rhine River</h3><p>The Rhine River's natural fortifications provided the bulk of the <i>Limes Germanicus</i> (Germanic frontier). The river's wide width and fast current made it a great defensive barrier. Gibbon posited that the barbarian crossing of the Rhine in 406 A.D might have been due to it freezing over.  </p> <img src = "https://d3ertfc829vzop.cloudfront.net/-/media/Tauck/Editorial/Images/SEO-Pages/River-Cruise-Guides/Best-Of/BestOf_Rhine_hero.jpg?rev=805076b8cb204d6788c24496ad3611d9" width = "200" height = "100" style = "display: block; margin-left: auto; margin-right: auto;">`})

let danubeRiver = L.polyline([
  [
    48.27953734226008,
    9.7613525390625
  ],
  [
    48.49840764096436,
    10.2447509765625
  ],
  [
    48.69458640884518,
    10.755615234375
  ],
  [
    48.77429274267509,
    11.5960693359375
  ],
  [
    49.01265386395502,
    12.0904541015625
  ],
  [
    48.91166975698412,
    12.6727294921875
  ],
  [
    48.785151998043155,
    13.018798828125
  ],
  [
    48.69458640884518,
    13.0792236328125
  ],
  [
    48.5275192374508,
    13.705444335937498
  ],
  [
    48.23199134320962,
    14.507446289062498
  ],
  [
    48.15509285476017,
    14.688720703124998
  ],
  [
    48.228332127214934,
    15.6719970703125
  ],
  [
    48.34529727896014,
    16.19659423828125
  ],
  [
    48.122101028190805,
    16.611328125
  ],
  [
    48.15509285476017,
    17.053527832031246
  ],
  [
    47.77256035513371,
    17.6715087890625
  ],
  [
    47.779943470641264,
    18.7261962890625
  ],
  [
    47.79470655664555,
    19.094238281249996
  ],
  [
    47.42437092240516,
    19.061279296875
  ],
  [
    45.93587062119052,
    18.720703125
  ],
  [
    45.29034662473613,
    19.0997314453125
  ],
  [
    45.182036837015886,
    20.23681640625
  ],
  [
    44.86365630540611,
    20.3411865234375
  ],
  [
    44.653024159812,
    20.8355712890625
  ],
  [
    44.81691551782855,
    21.3079833984375
  ],
  [
    44.66474608911831,
    21.68701171875
  ],
  [
    44.61393394730626,
    21.99462890625
  ],
  [
    44.4808302785626,
    22.0989990234375  
  ],
  [
    44.67646564865964,
    22.3406982421875
  ],
  [
    44.574817404670306,
    22.7471923828125
  ],
  [
    44.46123053905879,
    22.483520507812496
  ],
  [
    44.276671273775186,
    22.60986328125
  ],
  [
    44.14279782818058,
    22.840576171875
  ],
  [
    44.036269809534616,
    23.060302734375
  ],
  [
    43.89393401411192,
    22.8515625
  ],
  [
    43.78695837311561,
    23.0218505859375
  ],
  [
    43.73538317799622,
    24.6258544921875
  ],
  [
    43.620170616189895,
    25.499267578125
    ],
  [
    44.008620115415354,
    26.2353515625
  ],
  [
    44.14279782818058,
    27.081298828125
  ],
  [
    44.14279782818058,
    27.6470947265625
  ],
  [
    44.264871151101985,
    27.960205078125
  ],
  [
    44.24913396886892,
    28.32275390625
  ],
  [
    44.134913443750726,
    28.4326171875
  ],
  [
    44.14279782818058,
    28.6358642578125
  ]
]
, {
                                  color: riverCol,
                                  weight: 5,
                                  title: 'Danube River',
                                  windowContent: `<h3>The Danube River </h3 <p> The Danube River made up most of the eponymous <i>Limes Danibus</i> (Danubian frontier). It is even longer than the Rhine and Romans manned the river to defend from Barbarian groups in Dacia and Pannonia</p>`})
let frontiers = processManualLayers([hadriansWall, rhineRiver, danubeRiver], {description: 'Frontiers'})


////////////////////////////////////////////////
// array of all the layers!!!!!!!
// these layers will be added to the map
// you should change these variable names
// to align with the variables you've defiend above
let allLayers = [gryfMarkers, barMarkers, towns,  frontiers];


///////////////////////////////////////
// END DATA!!  END DATA!! END DATA!! //
///////////////////////////////////////

//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////
// FUNCTIONS FUNCTIONS FUNCTIONS FUNCTIONS //
/////////////////////////////////////////////


/**
 * create a Leaflet map inside an element, add base layer and return the map as a return value
 * @param {HTMLElement|string} element: can be either a full HTMLElement or the ID attribute
 * of a DOM node
 * @returns {Object} a Leaflet map object 
 */
function createMap (element) {
    const map = L.map(element, {renderer:L.canvas(), preferCanvas: true}).setView(myCenter, myZoom);
    // now we add the base layer
    // you can change this if you want!
    // if your tiles seem to load very slowly, you may want to generate your own accessToken
    // and insert the value in `accessToken`, below. 
    // see: https://docs.mapbox.com/help/how-mapbox-works/access-tokens/#creating-and-managing-access-tokens

    // to change the tile layer, change the `id` attribute below.
    // some valid options include:
    // mapbox/streets-v11
    // mapbox/outdoors-v11
    // mapbox/light-v10
    // mapbox/dark-v10
    // mapbox/satellite-v9
    // mapbox/satellite-streets-v11

    // I've also created a simple style using studio.mapbox.com, which you can access
    // with this id:
    // titaniumbones/ckhnvk5pl18o71apeq8q1duhc
    // You can modify it yourself using this link: 
    // https://api.mapbox.com/styles/v1/titaniumbones/ckhnvk5pl18o71apeq8q1duhc.html?fresh=true&title=copy&access_token=pk.eyJ1IjoidGl0YW5pdW1ib25lcyIsImEiOiJjazF0bTdlNXQwM3gxM2hwbXY0bWtiamM3In0.FFPm7UIuj_b15xnd7wOQig
    // Here's a green and blue one for good measure:
    // https://api.mapbox.com/styles/v1/titaniumbones/ckhnvqfda18qu19o2oool6h2c.html?fresh=true&title=copy&access_token=pk.eyJ1IjoidGl0YW5pdW1ib25lcyIsImEiOiJjazF0bTdlNXQwM3gxM2hwbXY0bWtiamM3In0.FFPm7UIuj_b15xnd7wOQig
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
	maxZoom: 18,
        id: 'mapbox/satellite-streets-v11',
        // id: 'titaniumbones/ckhnvk5pl18o71apeq8q1duhc',
        tileSize: 512,
        zoomOffset: -1,
	accessToken: 'pk.eyJ1IjoidGl0YW5pdW1ib25lcyIsImEiOiJjazF0bTdlNXQwM3gxM2hwbXY0bWtiamM3In0.FFPm7UIuj_b15xnd7wOQig'
    })
        .addTo(map);
    return map
}


/**
 * Add Markers to a "layerGroup" and return the populated object
 * @param {Array.<Object>} markerInfo
 * @param {string} markerInfo[].title
 * @param {Array|Object} markerInfo[].position
 * @param {Object} layerGroup
 * @returns {Object} the modified layerGroup object 
 */
function processMarkerLayer (markerInfo, options) {
    let layerGroup = L.layerGroup([], options);
    // iterate over the marker info array, adding to the main marker layer but
    // *also* to another layer if the icon property is set. 
    for (const m of markerInfo) {
        // define a Leaflet marker object for each marker
        // we pass two parameters: a position (2-value array of lat & lng vals)
        // and an object containing marker propertie
        let marker =  L.marker (m.position, {
            // We set the icon 
            icon:   m.icon || layerGroup.options.defaultIcon || L.Icon(),
            title: m.title,
            description: m.description,
            windowContent: m.windowContent //this is obsolete
        });
        let t = assembleTexts(marker);
        marker.bindPopup(t.popup);
        // this seems to be unnecessary on modern browsers for some reason
        //marker.bindTooltip(t.tooltip);
        layerGroup.addLayer(marker);
    }
    return layerGroup;
}

/**
 * create a geoJSON layer and return the geoJSON layer object.
 * If the featureGroup has the non-standard property
 * 'description' it will be explicitly set on the returned object as well.
 * If an individual feature has the property feature.properties.title,
 * then the options.title property will be set on the resultant layer
 * for compatibility with marker layers.
 * The custom property `feature.properties.myColor` will also be used to set line and
 * fill colors.
 * 
 * @param {GeoJSON} jsonData
 * @returns {Object} the newly-created geoJSON layer 
 */
function processJSONLayer (jsonData) {
    return L.geoJSON(jsonData, {
        // the 'style' option is a *function* that modifies some
        // feature properties.  
        // cf https://leafletjs.com/reference-1.5.0.html#geojson-style
        style: function(feature) {
            let c = feature.properties.myColor;
            return {color: c, weight: 3, fillColor: c, fillOpacity: 0.5};
        },
        onEachFeature: function (feature, layer) {
            layer.options.description = '';
            if (feature.properties ) {
                if (feature.properties.title) {
                    layer.options.title = feature.properties.title;
                }
                if (feature.properties.description) {
                    layer.options.description = feature.properties.description;
                }
            }
            let t = assembleTexts(layer);
            layer.bindPopup(t.popup);
            layer.bindTooltip(t.tooltip, {sticky: true});
        },
        description: jsonData.description || "GeoJSON Objects"
    });
}

/**
 * create a layerGroup from an array of individual Layer objects.
 * If the non-standard options `windowContent`, `title`, and/or `description` have been
 * set, they will be used to create a popup window and tooltip now, and
 * to generate legend text in `addLayerToLegendHTML` later on.
 * The `options` parameter should include a `description` property,
 * (NOTE: this is *separate* from the description of the individual layers!!)
 * which will also be used by `addLayerToLegendHTML` and in the layers
 * control box. 
 * @param {} layerArray
 * @param {} options
 * @returns {} 
 */
function processManualLayers (layerArray, options = {description: 'Unnamed Layer'}) {
    for (const l of layerArray) {
        let t = assembleTexts(l);
        l.bindPopup(t.popup);
        l.bindTooltip(t.tooltip, {sticky: true});
    }
    return L.layerGroup(layerArray, options)
}


function assembleTexts (feature) {
    let opts = feature.options,
        tooltip = 'Untitled Tooltip',
        popup = '<h2>Untitled</h2>',
        legend = 'Untitled';
    
    if (opts.title) {
        popup = `<h2>${opts.title}</h2>` + (opts.description || '');
        tooltip = opts.title;
        legend = opts.title;
    }
    if (opts.windowContent) {
        popup = opts.windowContent;
    }
    return {tooltip: tooltip, popup: popup, legend: legend};
}
/**
 * For every element of `layerGroup`, add an entry to the innerHTML of
 * the element matched by `querySelector`, consisting of a div whose
 * `onclick` attribute is a call to `locateMapFeature` which navigates to, and
 * opens the popup window of, that feature.  The link text will be one of `options.infoHTML`,
 * `options.title`, or 'no title', in that order.
 * @param {Array} layerGroup
 * @param {string} querySelector
 * @returns {string} innerHTML content of the legend element 
 */
function addLayerToLegendHTML (layerGroup, el) {
    let output = `<div class="legend-content-group-wrapper"><h2>${layerGroup.options.description}</h2>`;
    for (let l in layerGroup._layers) {
        // this is hideously ugly! very roundabout way
        // to access anonymous marker from outside the map
        let current = layerGroup._layers[l];
        let info = assembleTexts(current).legend;
        output +=  `
<div class="pointer" onclick="locateMapFeature(projectMap._layers[${layerGroup._leaflet_id}]._layers[${l}])"> 
    ${info} 
</div>`;
    }
    output += '</div>'
    el.innerHTML += output;
    return el.innerHTML
}

/* a function that will run when the page loads.  It creates the map
   and adds the existing layers to it. You probably don't need to change this function; 
   instead, change data and variable names above, or change some of the helper functions that
   precede this function.
 */
async function initializeMap() {

    // this one line creates the actual map
    // it calls a simple 2-line function defined above
    projectMap = createMap('map_canvas');
    // set the legend location
    let legendEl = document.querySelector('#map_legend');

    let layerListObject = {};
    // add markers to map and to legend, then add a toggle switch to layers control panel
    for (let l of allLayers) {
        l.addTo(projectMap);
        addLayerToLegendHTML(l, legendEl);
        layerListObject[l.options.description] = l;
    }

   // add a layers control to the map, using the layer list object
    // assigned above
    L.control.layers(null, layerListObject).addTo(projectMap);

    // You'll want to comment this out before handing in, but it makes life a bit easier.
    // while you're developing
    coordHelp();
}

/**
 * pan to object if it's a marker; otherwise use the `fitBounds` method on the feature
 * Then open the marker popup.
 * @param {Object} marker
 */
function locateMapFeature (marker) {
    marker.getLatLng ? projectMap.flyTo(marker.getLatLng(), 16, {animate: true, duration: 1.5}) : projectMap.fitBounds(marker.getBounds(), {animate: true, duration: 1.5}); 
    marker.openPopup();
}

function coordHelp () {
    projectMap.on('click', function(e) {
        console.log("Lat, Lon : [ " + e.latlng.lat + ", " + e.latlng.lng + " ]")
    });
}

function resetMap (map) {
    map.setView(myCenter, myZoom, {animate: true, duration: 1.5}).closePopups()
}
